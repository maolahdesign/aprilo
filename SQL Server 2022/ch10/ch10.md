# CH10 新增，更新與刪除

## insert/select
1. 建立通訊錄表單
```sql
create table Contacts(
	employee_id INT PRIMARY KEY,
    name NVARCHAR(100) NOT NULL,
    email NVARCHAR(100),
    phone NVARCHAR(20)
)
```

2. 將員工表單加入到通訊錄(ch10_2_3a)
```sql
insert into Contacts
select name ,email ,phone
from employees
```

3.欄位名稱不同呢
```sql
create table Contacts2(
	contact_id INT PRIMARY KEY IDENTITY(1,1),
    contact_name NVARCHAR(100) NOT NULL,
    email NVARCHAR(100),
    mobile NVARCHAR(20)
)
```

## select into(ch10_2_4a, 4a)
1. 建立 product_notobook 表單
```sql
select * into product_notebook
from products
where category_id = 1 
```

## update

1. 新增欄位 [Employees][dept_id] [int] 
2. 建立部門表單

dept_id |dept_name
--------|----------
1       |行銷
2       |業務
3       |開發
4       |公關

3. 使用 SSMS 將每個員工加入部門(10_3_1)

4. 加入三名新員工，不指定部門單位，新增完成後指派到各部門
```sql
update Employees set dept_id =3 where name='妙麗'
```

```sql
-- 將妙麗調到行銷部(使用子查詢)(10_3_2)
update Employees 
set dept_id =(select dept_id from  Departments where dept_name = '行銷')
where name='妙麗'
```

修改產品價格並更新訂單明細
1. orderDetail 表單 product_id 重複的商品
2. 修改 products 表單 product_id 的商品價格
3. 更新 orderDetail 單價及總價
```sql
update OrderDetails2
set unit_price = (select price from products where product_id = 20),subtotal = unit_price * quantity
where product_id = 20
```
-- 

## Delete 10_4_1
## MERGE 10_5a
```sql
CREATE TABLE NewProducts (
    product_id INT PRIMARY KEY,
    product_name NVARCHAR(200) NOT NULL,
    category_id INT,
	price DECIMAL(10, 2) NOT NULL,
    stock INT NOT NULL DEFAULT 0,
    created_at DATETIME DEFAULT GETDATE(),
    CONSTRAINT FK_Products_Categories_2 FOREIGN KEY (category_id) REFERENCES Categories(category_id)
);

INSERT INTO NewProducts (product_name, category_id, price,stock)
VALUES
-- 筆記型電腦
(N'nASUS VivoBook 16', 1, 10000, 15),
(N'nAcer Swift 8', 1,  10000,10),
(N'nMSI Modern 15', 1, 10000,8),
(N'nApple MacBook Air M3', 1,  10000,12)
```

```sql
merge products as p            --將 NewProducts 合併到 products
using NewProducts as np
on p.product_id = np.product_id
when matched then
	update set
		product_name = np.product_name,
		category_id = np.category_id,
		price = np.price,
		stock = np.stock
when not matched by target then
	insert (product_name, category_id, price, stock)
	values (np.product_name, np.category_id, np.price, np.stock);
```